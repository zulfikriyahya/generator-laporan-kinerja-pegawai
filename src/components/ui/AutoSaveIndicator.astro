---
// src/components/ui/AutoSaveIndicator.astro
---

<div
	x-data="autoSaveIndicator"
	x-show="visible"
	x-transition:enter="transition ease-out duration-300"
	x-transition:enter-start="opacity-0 translate-y-2"
	x-transition:enter-end="opacity-100 translate-y-0"
	x-transition:leave="transition ease-in duration-200"
	x-transition:leave-start="opacity-100 translate-y-0"
	x-transition:leave-end="opacity-0 translate-y-2"
	class="fixed bottom-4 right-4 z-50 no-print"
>
	<div
		class="flex items-center gap-2 px-4 py-2 rounded-lg shadow-lg border backdrop-blur-md"
		:class="{
			'bg-emerald-500/10 border-emerald-500/20 text-emerald-400': status === 'saved',
			'bg-blue-500/10 border-blue-500/20 text-blue-400': status === 'saving',
			'bg-red-500/10 border-red-500/20 text-red-400': status === 'error'
		}"
	>
		<!-- Saving Animation -->
		<svg
			x-show="status === 'saving'"
			class="animate-spin h-4 w-4"
			xmlns="http://www.w3.org/2000/svg"
			fill="none"
			viewBox="0 0 24 24"
		>
			<circle
				class="opacity-25"
				cx="12"
				cy="12"
				r="10"
				stroke="currentColor"
				stroke-width="4"></circle>
			<path
				class="opacity-75"
				fill="currentColor"
				d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
			></path>
		</svg>

		<!-- Saved Icon -->
		<svg
			x-show="status === 'saved'"
			class="h-4 w-4"
			fill="none"
			stroke="currentColor"
			viewBox="0 0 24 24"
		>
			<path
				stroke-linecap="round"
				stroke-linejoin="round"
				stroke-width="2"
				d="M5 13l4 4L19 7"></path>
		</svg>

		<!-- Error Icon -->
		<svg
			x-show="status === 'error'"
			class="h-4 w-4"
			fill="none"
			stroke="currentColor"
			viewBox="0 0 24 24"
		>
			<path
				stroke-linecap="round"
				stroke-linejoin="round"
				stroke-width="2"
				d="M6 18L18 6M6 6l12 12"></path>
		</svg>

		<span class="text-xs font-medium" x-text="message"></span>
	</div>
</div>

<script>
	document.addEventListener("alpine:init", () => {
		Alpine.data("autoSaveIndicator", () => ({
			visible: false,
			status: "saving", // saving, saved, error
			message: "",
			timeout: null,

			init() {
				// Listen to custom events
				window.addEventListener("autosave:start", () => {
					this.show("saving", "Menyimpan...");
				});

				window.addEventListener("autosave:success", () => {
					this.show("saved", "Tersimpan");
					this.hideAfter(2000);
				});

				window.addEventListener("autosave:error", () => {
					this.show("error", "Gagal menyimpan");
					this.hideAfter(3000);
				});
			},

			show(status, message) {
				clearTimeout(this.timeout);
				this.status = status;
				this.message = message;
				this.visible = true;
			},

			hideAfter(delay) {
				this.timeout = setTimeout(() => {
					this.visible = false;
				}, delay);
			},
		}));
	});
</script>